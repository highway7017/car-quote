<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</title>

  <style>
    :root{
      /* âœ… ë„ˆì˜ Apps Script ì›¹ì•± URLë¡œ ë°”ê¿”ì¤˜ (catalog / submit ì—”ë“œí¬ì¸íŠ¸ ì“°ëŠ” ë²„ì „) */
      --api-url: "https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec";

      /* ë°°ê²½ */
      --bg-pink-top: rgba(255, 164, 212, .42);
      --bg-pink-mid: rgba(255, 164, 212, .22);
      --bg-pink-bottom: rgba(255, 255, 255, .00);

      /* UI ì»¬ëŸ¬ */
      --text: #221a22;
      --muted: rgba(34,26,34,.64);
      --card: rgba(255,255,255,.78);
      --stroke: rgba(255,255,255,.55);
      --shadow: 0 18px 45px rgba(0,0,0,.10);

      --primaryA: #ff6fb1;
      --primaryB: #9b7cff;

      --radius-xl: 28px;
      --radius-lg: 20px;
      --radius-md: 14px;

      --gap: 14px;
      --max: 980px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Apple SD Gothic Neo, sans-serif;
      color: var(--text);

      /* âœ… "ì´ë¯¸ì§€ ë„ˆë¹„ ë”± ë§ê²Œ" ëŠë‚Œ: ìƒë‹¨ì— ë°°ê²½ì´ë¯¸ì§€ë¥¼ 1ë²ˆë§Œ ê¹”ê³ (cover)
         ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ í•‘í¬â†’íˆ¬ëª…ìœ¼ë¡œ ë¹ ì§€ëŠ” ê·¸ë¼ ì˜¤ë²„ë ˆì´ */
      background:
        linear-gradient(180deg,
          var(--bg-pink-top) 0%,
          var(--bg-pink-mid) 38%,
          rgba(255,164,212,.10) 62%,
          var(--bg-pink-bottom) 100%
        ),
        url("bg.png");
      background-repeat: no-repeat;
      background-position: center top;
      background-size: 1100px auto; /* âœ… "í™”ë©´ ì „ì²´ cover" ë§ê³  ì´ë¯¸ì§€ í­ì„ ê³ ì •í•´ì„œ ë” ëª©ì—…ì²˜ëŸ¼ */
      background-attachment: scroll;

      /* ì•„ë˜ë¡œ ë‚´ë ¤ê°ˆìˆ˜ë¡ ìì—°ìŠ¤ëŸ½ê²Œ ë°ì•„ì§€ê²Œ */
      min-height: 100vh;
    }

    /* âœ… ìƒë‹¨ ë°°ê²½ì´ ë„ˆë¬´ ì»¤ì„œ ë°‘ê¹Œì§€ ê³„ì† ë³´ì´ë©´ ì—¬ê¸°ì„œ í˜ì´ë“œ í•œ ë²ˆ ë” */
    body::before{
      content:"";
      position: fixed;
      inset: 0;
      pointer-events: none;
      background: linear-gradient(180deg, rgba(255,255,255,.00) 0%, rgba(255,255,255,.20) 45%, rgba(255,255,255,.85) 100%);
      mix-blend-mode: normal;
      opacity: .55;
    }

    .wrap{
      position: relative;
      max-width: var(--max);
      margin: 0 auto;
      padding: 28px 16px 36px;
    }

    /* âœ… íƒ€ì´í‹€ì€ ë°°ê²½ ìœ„ì— ë°”ë¡œ(ë³„ë„ divë¡œ ê°ì‹¸ì§€ ì•Šê³ ) */
    header{
      text-align:center;
      padding: 38px 14px 22px;
    }
    h1{
      margin:0;
      font-size: 30px;
      letter-spacing: -0.6px;
      font-weight: 900;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }
    .sub{
      margin: 10px 0 0;
      font-size: 14px;
      font-weight: 700;
      color: rgba(34,26,34,.62);
    }

    /* ì „ì²´ ì¹´ë“œ(ë‚´ìš© ì˜ì—­) */
    .shell{
      background: rgba(255,255,255,.32);
      border: 1px solid rgba(255,255,255,.42);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .content{
      padding: 16px;
    }

    /* ì„¹ì…˜ ì¹´ë“œ */
    .section{
      background: var(--card);
      border: 1px solid rgba(255,255,255,.60);
      border-radius: 22px;
      padding: 16px;
      box-shadow: 0 12px 30px rgba(0,0,0,.06);
      backdrop-filter: blur(12px);
    }
    .section + .section{ margin-top: 14px; }

    .sec-title{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 2px 0 12px;
      font-weight: 900;
      font-size: 16px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      color: #a0186e;
      background: rgba(255,111,177,.15);
      border: 1px solid rgba(255,111,177,.18);
    }

    label{
      display:block;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 900;
      color: rgba(34,26,34,.86);
    }

    select, input{
      width: 100%;
      margin-top: 7px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.72);
      outline: none;
      font-size: 14px;
    }
    select:disabled, input:disabled{
      opacity: .6;
    }
    input::placeholder{ color: rgba(34,26,34,.40); }

    .help{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(34,26,34,.55);
      font-weight: 700;
    }

    /* ë¼ë””ì˜¤: í•œ ì¤„ë¡œ ì •ëˆ */
    .radio-row{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .chip{
      flex: 0 0 auto;
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.70);
      font-weight: 900;
      font-size: 13px;
    }
    .chip input{ width:auto; margin:0; }

    /* âœ… ê°œì¸ì •ë³´ ë™ì˜: ì²´í¬ë°•ìŠ¤-í…ìŠ¤íŠ¸ ê°„ê²© ë¬¸ì œ í•´ê²° */
    .consent{
      margin-top: 14px;
      background: rgba(255,255,255,.72);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 18px;
      padding: 14px;
    }
    .consent-row{
      display:flex;
      align-items:flex-start;
      gap: 10px;          /* âœ… ì—¬ê¸°! ê°„ê²© */
    }
    .consent-row input{
      width: 18px;
      height: 18px;
      margin-top: 2px;    /* âœ… í…ìŠ¤íŠ¸ ë² ì´ìŠ¤ë¼ì¸ ë§ì¶”ê¸° */
      flex: 0 0 auto;
    }
    .consent strong{
      display:block;
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
    }
    .consent small{
      display:block;
      color: rgba(34,26,34,.62);
      font-weight: 700;
      line-height: 1.45;
    }

    /* CTA ë²„íŠ¼: ëˆˆì— ë„ì§€ë§Œ ê³ ìƒí•˜ê²Œ */
    .cta{
      margin-top: 14px;
      padding: 16px;
      background: rgba(255,255,255,.62);
      border-top: 1px solid rgba(255,255,255,.55);
    }
    .btn{
      width: 100%;
      border: 0;
      cursor: pointer;
      border-radius: 999px;
      padding: 16px 16px;
      font-size: 17px;
      font-weight: 900;
      color: #fff;
      letter-spacing: -0.3px;

      /* âœ… ë‹¨ì •í•œ ê·¸ë¼ (ëª©ì—… ëŠë‚Œ) */
      background: linear-gradient(90deg, rgba(255,111,177,.95), rgba(155,124,255,.95));
      box-shadow: 0 14px 30px rgba(155,124,255,.24), 0 10px 22px rgba(255,111,177,.18);
    }
    .btn:disabled{
      opacity: .55;
      cursor: not-allowed;
      box-shadow: none;
    }
    .foot{
      margin-top: 12px;
      text-align:center;
      font-size: 12px;
      color: rgba(34,26,34,.58);
      font-weight: 800;
    }

    /* âœ… "ë°˜ ê°ˆë¼ ì…ë ¥" ì§€ì–‘: ê¸°ë³¸ì€ í•­ìƒ 1ì—´ */
    .single{ display:block; }

    /* ë°ìŠ¤í¬íƒ‘ì—ì„œë§Œ ì•½ê°„ ë„“ê²Œ ë³´ì—¬ë„ 'ë°˜ ê°ˆë¼'ëŠ” ê¸ˆì§€ë¼ 1ì—´ ìœ ì§€ */
    @media (min-width: 860px){
      .wrap{ padding-top: 36px; }
      header{ padding-top: 52px; }
      h1{ font-size: 34px; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <header>
      <h1>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</h1>
      <p class="sub">ê°„ë‹¨í•œ ì¡°ê±´ ì…ë ¥ìœ¼ë¡œ ë¹„ëŒ€ë©´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
    </header>

    <div class="shell">
      <div class="content">

        <!-- âœ… 1) ì°¨ëŸ‰ ì„ íƒ íŒŒíŠ¸ -->
        <section class="section" id="secCar">
          <div class="sec-title">ì°¨ëŸ‰ ì„ íƒ <span class="badge">í•„ìˆ˜</span></div>

          <div class="single">
            <label for="maker">ì œì¡°ì‚¬</label>
            <select id="maker">
              <option value="">ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>

            <label for="model">ì°¨ì¢…</label>
            <select id="model" disabled>
              <option value="">ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>

            <label for="trim">ì°¨ëŸ‰ ë“±ê¸‰</label>
            <select id="trim" disabled>
              <option value="">ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>

            <label for="option">ì˜µì…˜</label>
            <select id="option" disabled>
              <option value="">ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
            </select>

            <p class="help">â€» ì œì¡°ì‚¬ â†’ ì°¨ì¢… â†’ ë“±ê¸‰ â†’ ì˜µì…˜ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤.</p>
          </div>
        </section>

        <!-- âœ… 2) ì‹ ì²­ ì •ë³´ íŒŒíŠ¸ -->
        <section class="section" id="secApp">
          <div class="sec-title">ì‹ ì²­ ì •ë³´ <span class="badge">í•„ìˆ˜</span></div>

          <label>ê³ ê° ìœ í˜•</label>
          <div class="radio-row" id="customerType">
            <label class="chip"><input type="radio" name="customerType" value="ê°œì¸" checked> ê°œì¸</label>
            <label class="chip"><input type="radio" name="customerType" value="ê°œì¸ì‚¬ì—…ì"> ê°œì¸ì‚¬ì—…ì</label>
            <label class="chip"><input type="radio" name="customerType" value="ë²•ì¸"> ë²•ì¸</label>
          </div>

          <label for="name">ì„±ëª…</label>
          <input id="name" placeholder="ì˜ˆ) í™ê¸¸ë™" autocomplete="name" />

          <label for="phone">ì—°ë½ì²˜</label>
          <input id="phone" placeholder="ì˜ˆ) 010-1234-5678" inputmode="tel" autocomplete="tel" />

          <label for="needAt">ì°¨ëŸ‰ ì¸ë„ ì‹œê¸°</label>
          <input id="needAt" placeholder="ì˜ˆ) ê°€ëŠ¥í•œ ë¹¨ë¦¬ / 2ì›” ì¤‘ìˆœ / ë¯¸ì •" />

          <label for="kakao">ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë”” (ì„ íƒ)</label>
          <input id="kakao" placeholder="ì˜ˆ) melody7017" />

          <!-- ê°œì¸ì •ë³´ ë™ì˜ -->
          <div class="consent">
            <div class="consent-row">
              <input id="agree" type="checkbox" />
              <div>
                <strong>[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong>
                <small>
                  ìˆ˜ì§‘: ì„±ëª…, ì—°ë½ì²˜, ì¹´ì¹´ì˜¤í†¡ ID(ì„ íƒ), ì°¨ëŸ‰ ì„ íƒ ì •ë³´<br>
                  ëª©ì : ê²¬ì Â·ìƒë‹´ ì•ˆë‚´<br>
                  ë³´ìœ : ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
                </small>
              </div>
            </div>
          </div>
        </section>

      </div>

      <div class="cta">
        <button class="btn" id="submitBtn" disabled>ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°</button>
        <div class="foot">ë°©ë¬¸ ì—†ì´ ëª¨ë‘ ë¹„ëŒ€ë©´ìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = getComputedStyle(document.documentElement).getPropertyValue('--api-url').trim().replace(/^"|"$/g,'');
    const els = {
      maker: document.getElementById('maker'),
      model: document.getElementById('model'),
      trim: document.getElementById('trim'),
      option: document.getElementById('option'),
      name: document.getElementById('name'),
      phone: document.getElementById('phone'),
      needAt: document.getElementById('needAt'),
      kakao: document.getElementById('kakao'),
      agree: document.getElementById('agree'),
      submitBtn: document.getElementById('submitBtn')
    };

    let catalog = []; // {maker, model, trim, option, ...}

    function valRadio(name){
      const el = document.querySelector(`input[name="${name}"]:checked`);
      return el ? el.value : '';
    }

    function setOptions(select, arr, placeholder){
      select.innerHTML = '';
      const ph = document.createElement('option');
      ph.value = '';
      ph.textContent = placeholder;
      select.appendChild(ph);

      arr.forEach(v => {
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        select.appendChild(opt);
      });
    }

    function uniq(arr){ return Array.from(new Set(arr)).filter(Boolean).sort((a,b)=>a.localeCompare(b,'ko')); }

    function resetDown(from){
      if(from === 'maker'){
        els.model.disabled = true; setOptions(els.model, [], 'ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.trim.disabled = true; setOptions(els.trim, [], 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      if(from === 'model'){
        els.trim.disabled = true; setOptions(els.trim, [], 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      if(from === 'trim'){
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      validate();
    }

    function validate(){
      const okCar = !!els.maker.value && !!els.model.value && !!els.trim.value && !!els.option.value;
      const okApp = els.name.value.trim().length > 1 && els.phone.value.trim().length >= 8 && els.needAt.value.trim().length >= 1;
      const ok = okCar && okApp && els.agree.checked;
      els.submitBtn.disabled = !ok;
    }

    async function fetchCatalog(){
      // action=catalog ëŠ” ë„ˆê°€ ì´ë¯¸ ì“°ë˜ ë°©ì‹ ê·¸ëŒ€ë¡œ
      const url = `${API_URL}?action=catalog`;
      const res = await fetch(url, { method:'GET' });
      if(!res.ok) throw new Error('ì¹´íƒˆë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      const data = await res.json();

      // dataê°€ ë°°ì—´ì´ë“  {items:[]}ë“  ë‘˜ ë‹¤ ì²˜ë¦¬
      catalog = Array.isArray(data) ? data : (data.items || []);
    }

    function initMaker(){
      const makers = uniq(catalog.map(r => r.maker || r.ì œì¡°ì‚¬));
      setOptions(els.maker, makers, 'ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onMaker(){
      resetDown('maker');
      const maker = els.maker.value;
      if(!maker) return;

      const models = uniq(catalog
        .filter(r => (r.maker || r.ì œì¡°ì‚¬) === maker)
        .map(r => r.model || r.ì°¨ì¢… || r.ëª¨ë¸));

      els.model.disabled = false;
      setOptions(els.model, models, 'ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onModel(){
      resetDown('model');
      const maker = els.maker.value;
      const model = els.model.value;
      if(!maker || !model) return;

      const trims = uniq(catalog
        .filter(r => (r.maker || r.ì œì¡°ì‚¬) === maker && (r.model || r.ì°¨ì¢… || r.ëª¨ë¸) === model)
        .map(r => r.trim || r.ì°¨ëŸ‰ë“±ê¸‰ || r.íŠ¸ë¦¼ || r.ë“±ê¸‰));

      els.trim.disabled = false;
      setOptions(els.trim, trims, 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onTrim(){
      resetDown('trim');
      const maker = els.maker.value;
      const model = els.model.value;
      const trim  = els.trim.value;
      if(!maker || !model || !trim) return;

      const options = uniq(catalog
        .filter(r =>
          (r.maker || r.ì œì¡°ì‚¬) === maker &&
          (r.model || r.ì°¨ì¢… || r.ëª¨ë¸) === model &&
          (r.trim  || r.ì°¨ëŸ‰ë“±ê¸‰ || r.íŠ¸ë¦¼ || r.ë“±ê¸‰) === trim
        )
        .map(r => r.option || r.ì˜µì…˜));

      els.option.disabled = false;
      setOptions(els.option, options, 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    async function submit(){
      els.submitBtn.disabled = true;
      els.submitBtn.textContent = 'ì „ì†¡ ì¤‘...';

      const payload = {
        maker: els.maker.value,
        model: els.model.value,
        trim: els.trim.value,
        option: els.option.value,
        customerType: valRadio('customerType'),
        name: els.name.value.trim(),
        phone: els.phone.value.trim(),
        needAt: els.needAt.value.trim(),
        kakao: els.kakao.value.trim(),
        agreedAt: new Date().toISOString()
      };

      try{
        const res = await fetch(API_URL, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ action:'submit', payload })
        });
        const data = await res.json().catch(()=>({ok:false}));

        if(!res.ok || data.ok === false){
          throw new Error(data.message || 'ì ‘ìˆ˜ ì‹¤íŒ¨');
        }

        alert('ì ‘ìˆ˜ ì™„ë£Œ! ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ˜Š');

        // í¼ ë¦¬ì…‹(ì°¨ëŸ‰ ì„ íƒì€ ë‚¨ê¸°ê³  ì‹¶ìœ¼ë©´ ì´ ë¶€ë¶„ ë°”ê¿”ë„ ë¨)
        els.name.value = '';
        els.phone.value = '';
        els.needAt.value = '';
        els.kakao.value = '';
        els.agree.checked = false;
        validate();

      }catch(e){
        alert('ì „ì†¡ ì¤‘ ì˜¤ë¥˜: ' + e.message);
      }finally{
        els.submitBtn.textContent = 'ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°';
        validate();
      }
    }

    // ì´ë²¤íŠ¸
    els.maker.addEventListener('change', onMaker);
    els.model.addEventListener('change', onModel);
    els.trim.addEventListener('change', onTrim);
    els.option.addEventListener('change', validate);

    ['input','change'].forEach(evt=>{
      els.name.addEventListener(evt, validate);
      els.phone.addEventListener(evt, validate);
      els.needAt.addEventListener(evt, validate);
      els.kakao.addEventListener(evt, validate);
      els.agree.addEventListener(evt, validate);
      document.getElementById('customerType').addEventListener(evt, validate);
    });

    els.submitBtn.addEventListener('click', submit);

    // ì‹œì‘
    (async function(){
      try{
        await fetchCatalog();
        initMaker();
      }catch(e){
        alert('ì´ˆê¸° ë¡œë”© ì‹¤íŒ¨: ' + e.message + '\n(ì›¹ì•± URL / action=catalog ì‘ë‹µì„ í™•ì¸í•´ì¤˜)');
      }
    })();
  </script>
</body>
</html>
