<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</title>

  <style>
    :root{
      --txt:#1f1f23;
      --muted:rgba(31,31,35,.62);
      --card:rgba(255,255,255,.86);
      --stroke:rgba(255,255,255,.55);
      --shadow: 0 18px 55px rgba(0,0,0,.16);
      --soft: 0 10px 28px rgba(0,0,0,.10);

      --pink-1: rgba(255, 214, 232, .90);
      --pink-2: rgba(255, 194, 221, .68);
      --pink-3: rgba(255, 231, 244, .55);
      --pink-4: rgba(255, 245, 250, .92);

      --brand-a: #ff4aa0;
      --brand-b: #b96cff;

      --radius-lg: 26px;
      --radius-md: 18px;
      --radius-sm: 14px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Noto Sans KR", Segoe UI, Roboto, Helvetica, Arial, sans-serif;
      color:var(--txt);

      /* âœ… ì´ë¯¸ì§€ ì•„ë˜ë¡œ ë°›ì³ì£¼ëŠ” â€œí•‘í¬ ë°°ê²½ ê·¸ë¼â€ */
      background:
        radial-gradient(1200px 700px at 50% -200px, rgba(255,105,180,.35) 0%, rgba(255,105,180,0) 60%),
        linear-gradient(180deg,
          rgba(255, 164, 204, .55) 0%,
          rgba(255, 196, 223, .40) 22%,
          rgba(255, 221, 237, .26) 48%,
          rgba(255, 245, 250, .92) 100%);
      overflow-x:hidden;
    }

    /* âœ… ìƒë‹¨ â€œë°°ê²½ ì´ë¯¸ì§€ ì˜ì—­â€ */
    .hero-bg{
      position:relative;
      width:100%;
      /* ì´ë¯¸ì§€ ë†’ì´: í™”ë©´ì— ë”°ë¼ ìì—°ìŠ¤ëŸ½ê²Œ */
      height: min(56vh, 520px);
      min-height: 300px;
      background-image: url("bg.png");
      background-size: cover;      /* âœ… ì´ë¯¸ì§€ ë„ˆë¹„/ë†’ì´ ê½‰ */
      background-position: center; /* âœ… ì¤‘ì•™ */
      background-repeat: no-repeat;
    }

    /* âœ… ì´ë¯¸ì§€ ì•„ë˜ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ì—°ê²°ë˜ëŠ” â€œí˜ì´ë“œ ë ˆì´ì–´â€ */
    .hero-bg::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-1px;
      height: 48%;
      /* íˆ¬ëª… â†’ í•‘í¬ë¡œ ì—°ê²° (ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì˜…ì–´ì§€ê²ŒëŠ” bodyê°€ ë‹´ë‹¹) */
      background: linear-gradient(
        180deg,
        rgba(255, 205, 228, 0) 0%,
        rgba(255, 205, 228, .35) 40%,
        rgba(255, 205, 228, .68) 100%
      );
      pointer-events:none;
    }

    /* âœ… ì „ì²´ ì»¨í…Œì´ë„ˆ */
    .wrap{
      width: min(980px, 100%);
      margin: 0 auto;
      padding: 0 16px 40px;
      position:relative;
    }

    /* âœ… íƒ€ì´í‹€ì€ ë°°ê²½ ìœ„ì— â€œë°”ë¡œâ€ */
    .title-area{
      position: relative;
      margin-top: -110px; /* ì´ë¯¸ì§€ ìœ„ì—ì„œ ë‚´ë ¤ì˜¤ê²Œ */
      text-align:center;
      padding: 0 10px;
    }
    .title-area h1{
      margin:0;
      font-size: 30px;
      font-weight: 900;
      letter-spacing: -0.6px;
      text-shadow: 0 2px 18px rgba(0,0,0,.22);
    }
    .title-area p{
      margin: 8px 0 0;
      font-size: 14px;
      font-weight: 700;
      color: rgba(0,0,0,.58);
      text-shadow: 0 2px 16px rgba(255,255,255,.65);
    }

    /* âœ… ì¹´ë“œ */
    .card{
      margin-top: 18px;
      border-radius: var(--radius-lg);
      background: var(--card);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      overflow:hidden;
      backdrop-filter: blur(10px);
    }
    .card-inner{ padding: 18px; }

    .section-head{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 0 0 10px;
    }
    .section-head h2{
      margin:0;
      font-size: 18px;
      font-weight: 900;
      letter-spacing:-.3px;
    }
    .badge{
      font-size: 12px;
      font-weight: 900;
      padding: 4px 10px;
      border-radius: 999px;
      color: #9b1b62;
      background: rgba(255, 126, 188, .18);
      border: 1px solid rgba(255, 126, 188, .22);
    }

    label{
      display:block;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 900;
    }

    select, input{
      width:100%;
      margin-top: 8px;
      padding: 13px 14px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.08);
      background: rgba(255,255,255,.85);
      outline: none;
      font-size: 15px;
      box-shadow: var(--soft);
    }
    select:disabled, input:disabled{ opacity:.6; }

    .help{
      margin-top: 10px;
      font-size: 12px;
      font-weight: 700;
      color: rgba(0,0,0,.55);
    }

    /* âœ… ê³ ê°ìœ í˜• ë¼ë””ì˜¤: ë°˜ê°ˆë¼ ì…ë ¥ ì§€ì–‘ â†’ í•œ ì¤„ ë¼ë””ì˜¤ */
    .radios{
      display:flex;
      gap:10px;
      margin-top: 10px;
      flex-wrap:wrap;
    }
    .radio-pill{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.82);
      box-shadow: var(--soft);
      font-weight: 900;
      font-size: 14px;
      user-select:none;
    }
    .radio-pill input{ width:auto; margin:0; accent-color: var(--brand-a); }

    /* âœ… ê°œì¸ì •ë³´ ë™ì˜: ì²´í¬ë°•ìŠ¤ë‘ í…ìŠ¤íŠ¸ ë¶™ì—¬ì£¼ê¸° */
    .consent{
      margin-top: 14px;
      padding: 14px;
      border-radius: 18px;
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(0,0,0,.08);
      box-shadow: var(--soft);
    }
    .consent-row{
      display:flex;
      align-items:flex-start;
      gap:10px; /* âœ… ì—¬ê¸°ë¡œ ê±°ë¦¬ ì¡°ì ˆ */
    }
    .consent-row input{
      width: 20px;
      height: 20px;
      margin-top: 2px;
      flex: 0 0 auto;
      accent-color: var(--brand-a);
      box-shadow:none;
    }
    .consent b{
      font-size: 14px;
      font-weight: 950;
      display:block;
      margin-bottom: 6px;
    }
    .consent small{
      display:block;
      color: rgba(0,0,0,.55);
      font-size: 12px;
      font-weight: 700;
      line-height: 1.35;
    }

    /* âœ… ì œì¶œ ë²„íŠ¼: ëˆˆì— ë„ë˜ ë‹¨ì •í•œ ê·¸ë¼ */
    .cta-wrap{
      margin-top: 16px;
      padding: 18px;
      border-radius: var(--radius-lg);
      background: rgba(255,255,255,.78);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
    }
    .cta{
      width:100%;
      border:0;
      border-radius: 999px;
      padding: 16px 16px;
      font-size: 18px;
      font-weight: 950;
      letter-spacing: -0.2px;
      color: white;
      cursor:pointer;
      background: linear-gradient(135deg,
        rgba(255,74,160,.95) 0%,
        rgba(210,96,255,.92) 55%,
        rgba(140,120,255,.90) 100%);
      box-shadow: 0 12px 28px rgba(255,74,160,.28), 0 10px 24px rgba(120,120,255,.18);
      transition: transform .08s ease, filter .12s ease, opacity .12s ease;
    }
    .cta:active{ transform: translateY(1px) scale(.995); filter: brightness(.98); }
    .cta:disabled{ opacity:.45; cursor:not-allowed; }

    .foot{
      margin-top: 10px;
      text-align:center;
      color: rgba(0,0,0,.55);
      font-weight: 800;
      font-size: 12px;
    }

    /* âœ… ì¹´ë“œ ê°„ê²© */
    .spacer{ height: 14px; }

    /* ëª¨ë°”ì¼ì—ì„œ íƒ€ì´í‹€ ìœ„ì¹˜ ì‚´ì§ ë³´ì • */
    @media (max-width: 420px){
      .title-area{ margin-top: -96px; }
      .title-area h1{ font-size: 28px; }
    }
  </style>
</head>

<body>
  <!-- ìƒë‹¨ ì´ë¯¸ì§€ ì˜ì—­ -->
  <div class="hero-bg" aria-hidden="true"></div>

  <div class="wrap">
    <!-- íƒ€ì´í‹€: div í•œ ë²ˆ ë” ê°ì‹¸ì§€ ë§ê³ , ë°”ë¡œ ì˜ì—­ í•˜ë‚˜ë§Œ -->
    <div class="title-area">
      <h1>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</h1>
      <p>ê°„ë‹¨í•œ ì¡°ê±´ ì…ë ¥ìœ¼ë¡œ ë¹„ëŒ€ë©´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
    </div>

    <!-- ì°¨ëŸ‰ ì„ íƒ -->
    <div class="card">
      <div class="card-inner">
        <div class="section-head">
          <h2>ì°¨ëŸ‰ ì„ íƒ</h2>
          <span class="badge">í•„ìˆ˜</span>
        </div>

        <label for="maker">ì œì¡°ì‚¬</label>
        <select id="maker">
          <option value="">ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        </select>

        <label for="model">ì°¨ì¢…</label>
        <select id="model" disabled>
          <option value="">ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        </select>

        <label for="grade">ì°¨ëŸ‰ ë“±ê¸‰</label>
        <select id="grade" disabled>
          <option value="">ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        </select>

        <label for="option">ì˜µì…˜</label>
        <select id="option" disabled>
          <option value="">ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
        </select>

        <div class="help">â€» ì œì¡°ì‚¬ â†’ ì°¨ì¢… â†’ ë“±ê¸‰ â†’ ì˜µì…˜ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤.</div>
      </div>
    </div>

    <div class="spacer"></div>

    <!-- ì‹ ì²­ ì •ë³´ -->
    <div class="card">
      <div class="card-inner">
        <div class="section-head">
          <h2>ì‹ ì²­ ì •ë³´</h2>
          <span class="badge">í•„ìˆ˜</span>
        </div>

        <label>ê°œì¸ / ê°œì¸ì‚¬ì—…ì / ë²•ì¸</label>
        <div class="radios" role="radiogroup" aria-label="ê³ ê° ìœ í˜•">
          <label class="radio-pill"><input type="radio" name="customerType" value="ê°œì¸" checked>ê°œì¸</label>
          <label class="radio-pill"><input type="radio" name="customerType" value="ê°œì¸ì‚¬ì—…ì">ê°œì¸ì‚¬ì—…ì</label>
          <label class="radio-pill"><input type="radio" name="customerType" value="ë²•ì¸">ë²•ì¸</label>
        </div>

        <label for="name">ì„±ëª…</label>
        <input id="name" placeholder="ì˜ˆ) í™ê¸¸ë™" autocomplete="name" />

        <label for="phone">ì—°ë½ì²˜</label>
        <input id="phone" placeholder="ì˜ˆ) 010-1234-5678" inputmode="tel" autocomplete="tel" />

        <label for="needDate">ì°¨ëŸ‰ ì¸ë„ ì‹œê¸°</label>
        <input id="needDate" placeholder="ì˜ˆ) ê°€ëŠ¥í•œ ë¹¨ë¦¬ / 2ì›” ì¤‘ìˆœ / ë¯¸ì •" />

        <label for="kakao">ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë”” (ì„ íƒ)</label>
        <input id="kakao" placeholder="ì˜ˆ) melody7017" autocomplete="username" />

        <div class="consent">
          <div class="consent-row">
            <input type="checkbox" id="agree" />
            <div>
              <b>[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</b>
              <small>ìˆ˜ì§‘: ì„±ëª…, ì—°ë½ì²˜, ì¹´ì¹´ì˜¤í†¡ ID(ì„ íƒ), ì°¨ëŸ‰ ì„ íƒ ì •ë³´</small>
              <small>ëª©ì : ê²¬ì Â·ìƒë‹´ ì•ˆë‚´</small>
              <small>ë³´ìœ : ìƒë‹´ ì™„ë£Œ í›„ 1ë…„</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- ë²„íŠ¼ -->
    <div class="cta-wrap">
      <button class="cta" id="submitBtn" disabled>ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°</button>
      <div class="foot">ë°©ë¬¸ ì—†ì´ ëª¨ë‘ ë¹„ëŒ€ë©´ìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</div>
    </div>
  </div>

  <script>
    // âœ… ë„¤ ì›¹ì•± ì£¼ì†Œ(ì‚¬ìš©ìê°€ ì¤€ ê²ƒ)
    const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbyc1TZg4YplZx91lmam-RbpugEWEWKUw3SCAX0-PWUbWfrDDJczIWlOi36CkJQ4VE6A/exec";

    // =========================
    // 1) UI ìœ íš¨ì„±
    // =========================
    const el = (id) => document.getElementById(id);

    const maker = el("maker");
    const model = el("model");
    const grade = el("grade");
    const option = el("option");

    const nameEl = el("name");
    const phoneEl = el("phone");
    const needDateEl = el("needDate");
    const kakaoEl = el("kakao");
    const agreeEl = el("agree");
    const submitBtn = el("submitBtn");

    function getCustomerType(){
      const checked = document.querySelector('input[name="customerType"]:checked');
      return checked ? checked.value : "";
    }

    function canSubmit(){
      const okCar = maker.value && model.value && grade.value && option.value;
      const okUser = nameEl.value.trim().length >= 2 && phoneEl.value.trim().length >= 9 && needDateEl.value.trim().length >= 1;
      const okAgree = agreeEl.checked;
      return !!(okCar && okUser && okAgree);
    }

    function refreshSubmit(){
      submitBtn.disabled = !canSubmit();
    }

    [maker, model, grade, option, nameEl, phoneEl, needDateEl, kakaoEl, agreeEl].forEach(x=>{
      x.addEventListener("input", refreshSubmit);
      x.addEventListener("change", refreshSubmit);
    });

    // =========================
    // 2) ëª¨ë¸ ë°ì´í„° ë¡œë”©
    //    - JSONP ìš°ì„ (ê¶Œì¥)
    //    - ì‹¤íŒ¨í•˜ë©´ fetch ì‹œë„(ë  ìˆ˜ë„ ìˆìŒ)
    // =========================
    let catalog = []; // ì›ë³¸ ë°ì´í„°
    let makers = [];
    let modelsByMaker = {};
    let gradesByMakerModel = {};
    let optionsByKey = {};

    function resetSelect(selectEl, placeholder){
      selectEl.innerHTML = `<option value="">${placeholder}</option>`;
    }

    function disableChain(from){
      if(from === "model"){
        model.disabled = true; grade.disabled = true; option.disabled = true;
        resetSelect(model, "ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
        resetSelect(grade, "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
        resetSelect(option, "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
      }
      if(from === "grade"){
        grade.disabled = true; option.disabled = true;
        resetSelect(grade, "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
        resetSelect(option, "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
      }
      if(from === "option"){
        option.disabled = true;
        resetSelect(option, "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
      }
      refreshSubmit();
    }

    function fillSelect(selectEl, list, placeholder){
      resetSelect(selectEl, placeholder);
      list.forEach(v=>{
        const opt = document.createElement("option");
        opt.value = v;
        opt.textContent = v;
        selectEl.appendChild(opt);
      });
      selectEl.disabled = list.length === 0;
    }

    maker.addEventListener("change", ()=>{
      const mk = maker.value;
      disableChain("model");
      if(!mk) return;
      const list = (modelsByMaker[mk] || []);
      fillSelect(model, list, "ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
    });

    model.addEventListener("change", ()=>{
      const mk = maker.value;
      const md = model.value;
      disableChain("grade");
      if(!mk || !md) return;
      const key = `${mk}|||${md}`;
      const list = (gradesByMakerModel[key] || []);
      fillSelect(grade, list, "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
    });

    grade.addEventListener("change", ()=>{
      const mk = maker.value;
      const md = model.value;
      const gr = grade.value;
      disableChain("option");
      if(!mk || !md || !gr) return;
      const key = `${mk}|||${md}|||${gr}`;
      const list = (optionsByKey[key] || []);
      fillSelect(option, list, "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
    });

    // ë°ì´í„° ì •ê·œí™”: Models ì‹œíŠ¸ ì»¬ëŸ¼ëª…ì€ í™˜ê²½ë§ˆë‹¤ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ë„ë„í•˜ê²Œ ë§¤ì¹­
    function normRow(r){
      // ê°€ëŠ¥í•œ í‚¤ í›„ë³´ë“¤
      const get = (...keys) => {
        for(const k of keys){
          if(r[k] != null && String(r[k]).trim() !== "") return String(r[k]).trim();
        }
        return "";
      };
      return {
        maker: get("Maker","maker","ì œì¡°ì‚¬","ë¸Œëœë“œ","Brand"),
        model: get("Model","model","ì°¨ì¢…","ëª¨ë¸","ì°¨ëŸ‰ëª…"),
        grade: get("Grade","grade","íŠ¸ë¦¼","ë“±ê¸‰","ì°¨ëŸ‰ ë“±ê¸‰","ì°¨ëŸ‰ë“±ê¸‰"),
        option: get("Option","option","ì˜µì…˜","íŒ¨í‚¤ì§€","ì„ íƒì˜µì…˜"),
      };
    }

    function buildIndex(rows){
      catalog = rows.map(normRow).filter(x=>x.maker && x.model && x.grade); // ì˜µì…˜ì€ ë¹„ì–´ë„ ë  ìˆ˜ ìˆìŒ
      makers = Array.from(new Set(catalog.map(x=>x.maker)));

      modelsByMaker = {};
      gradesByMakerModel = {};
      optionsByKey = {};

      for(const row of catalog){
        if(!modelsByMaker[row.maker]) modelsByMaker[row.maker] = new Set();
        modelsByMaker[row.maker].add(row.model);

        const mm = `${row.maker}|||${row.model}`;
        if(!gradesByMakerModel[mm]) gradesByMakerModel[mm] = new Set();
        gradesByMakerModel[mm].add(row.grade);

        const key = `${row.maker}|||${row.model}|||${row.grade}`;
        if(!optionsByKey[key]) optionsByKey[key] = new Set();
        if(row.option) optionsByKey[key].add(row.option);
      }

      // Set -> Array
      for(const k in modelsByMaker) modelsByMaker[k] = Array.from(modelsByMaker[k]).sort();
      for(const k in gradesByMakerModel) gradesByMakerModel[k] = Array.from(gradesByMakerModel[k]).sort();
      for(const k in optionsByKey){
        const arr = Array.from(optionsByKey[k]).sort();
        optionsByKey[k] = arr.length ? arr : ["(ì˜µì…˜ ì—†ìŒ)"];
      }
      makers = makers.sort();

      fillSelect(maker, makers, "ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
    }

    function loadCatalogJSONP(){
      return new Promise((resolve, reject)=>{
        const cbName = "cb_" + Math.random().toString(36).slice(2);
        window[cbName] = (data)=>{
          try{
            delete window[cbName];
            script.remove();
          }catch(e){}
          resolve(data);
        };

        const script = document.createElement("script");
        script.src = `${WEBAPP_URL}?action=catalog&callback=${cbName}&_=${Date.now()}`;
        script.onerror = ()=>{
          try{ delete window[cbName]; }catch(e){}
          reject(new Error("JSONP load failed"));
        };
        document.body.appendChild(script);
      });
    }

    async function loadCatalog(){
      try{
        const data = await loadCatalogJSONP();
        const rows = (data && (data.rows || data.data || data)) || [];
        buildIndex(Array.isArray(rows) ? rows : []);
        return;
      }catch(e){
        // fetch fallback
      }

      try{
        const res = await fetch(`${WEBAPP_URL}?action=catalog&_=${Date.now()}`, { method:"GET" });
        const data = await res.json();
        const rows = (data && (data.rows || data.data || data)) || [];
        buildIndex(Array.isArray(rows) ? rows : []);
      }catch(e){
        // ì‹¤íŒ¨ í‘œì‹œ
        maker.innerHTML = `<option value="">ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</option>`;
        maker.disabled = true;
      }
    }

    loadCatalog();

    // =========================
    // 3) ì œì¶œ
    // =========================
    async function submit(){
      if(!canSubmit()) return;

      submitBtn.disabled = true;
      submitBtn.textContent = "ì „ì†¡ ì¤‘â€¦";

      const payload = {
        action: "submit",
        maker: maker.value,
        model: model.value,
        grade: grade.value,
        option: option.value,
        customerType: getCustomerType(),
        name: nameEl.value.trim(),
        phone: phoneEl.value.trim(),
        needDate: needDateEl.value.trim(),
        kakao: kakaoEl.value.trim(),
        ts: new Date().toISOString()
      };

      // 1) fetch POST ì‹œë„
      try{
        const res = await fetch(WEBAPP_URL, {
          method: "POST",
          headers: { "Content-Type":"application/json" },
          body: JSON.stringify(payload)
        });
        const data = await res.json().catch(()=>({ok: res.ok}));
        if(res.ok && (data.ok !== false)){
          alert("ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ™‚");
          location.reload();
          return;
        }
      }catch(e){}

      // 2) ì‹¤íŒ¨ ì‹œ í¼(iframe)ë¡œ fallback (CORS ëŒ€ë¹„)
      try{
        const iframe = document.createElement("iframe");
        iframe.name = "hiddenFrame";
        iframe.style.display = "none";
        document.body.appendChild(iframe);

        const form = document.createElement("form");
        form.method = "POST";
        form.action = WEBAPP_URL;
        form.target = "hiddenFrame";

        // Apps Scriptê°€ form-urlencodedë¡œ ë°›ì„ ë•Œë¥¼ ëŒ€ë¹„
        const flat = { ...payload };
        for(const k in flat){
          const input = document.createElement("input");
          input.type = "hidden";
          input.name = k;
          input.value = String(flat[k] ?? "");
          form.appendChild(input);
        }
        document.body.appendChild(form);
        form.submit();

        alert("ìš”ì²­ì´ ì ‘ìˆ˜ë˜ì—ˆìŠµë‹ˆë‹¤. ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ™‚");
        location.reload();
        return;
      }catch(e){
        alert("ì „ì†¡ì— ì‹¤íŒ¨í–ˆì–´ìš”. ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸(ì›¹ì•±) ì„¤ì •/ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
      }finally{
        submitBtn.textContent = "ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°";
        refreshSubmit();
      }
    }

    submitBtn.addEventListener("click", submit);
  </script>
</body>
</html>
