<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</title>

  <style>
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; font-family:-apple-system,BlinkMacSystemFont,"Noto Sans KR",system-ui,sans-serif; color:#1f1f1f; }

    /* âœ… ë°°ê²½ìƒ‰(í•‘í¬ ë² ì´ìŠ¤)ë„ ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì˜…ì–´ì§€ê²Œ */
    body{
      min-height:100vh;
      background:
        linear-gradient(
          to bottom,
          rgba(247,154,196,.85) 0%,
          rgba(255,196,224,.55) 28%,
          rgba(255,233,244,.40) 55%,
          rgba(255,255,255,.95) 100%
        );
    }

    /* âœ… HERO: ì´ë¯¸ì§€ + ì´ë¯¸ì§€ìš© ê·¸ë¼ë¥¼ í•œ ë ˆì´ì–´(::before)ë¡œ ê³ ì • => ëª¨ë°”ì¼ì—ì„œë„ ì•ˆ ì‚¬ë¼ì§ */
    .hero{
      position:relative;
      height:min(56vh,520px);
      min-height:340px;
      overflow:hidden;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding: 22px 16px 18px;
    }
    .hero::before{
      content:"";
      position:absolute;
      inset:0;
      background-image:
        /* ì´ë¯¸ì§€ ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ìì—°ìŠ¤ëŸ½ê²Œ ì˜…ì–´ì§€ëŠ”(íˆ¬ëª…) ê·¸ë¼ */
        linear-gradient(
          to bottom,
          rgba(255,255,255,0) 0%,
          rgba(255,255,255,0) 52%,
          rgba(255,208,232,.22) 66%,
          rgba(255,208,232,.36) 76%,
          rgba(255,255,255,.00) 100%
        ),
        url("bg.jpg");
      background-repeat:no-repeat;
      background-position:center, center;
      background-size:100% 100%, cover;
      filter:saturate(1.02) contrast(1.02);
      transform: translateZ(0);
    }

    /* âœ… íƒ€ì´í‹€: ë¶ˆí•„ìš”í•œ div ê°ì‹¸ê¸° ì—†ì´ ë°”ë¡œ */
    .title{
      position:relative;
      text-align:center;
      width:min(520px,100%);
    }
    .title h1{
      margin:0;
      font-size:28px;
      font-weight:900;
      letter-spacing:-.6px;
      color:#201b1e;
      text-shadow: 0 1px 0 rgba(255,255,255,.35);
    }
    .title p{
      margin:8px 0 0;
      font-size:14px;
      font-weight:700;
      color:rgba(35,35,35,.75);
      letter-spacing:-.2px;
    }

    .wrap{
      max-width:520px;
      margin:-10px auto 44px;
      padding:0 16px;
    }

    /* ì¹´ë“œ */
    .card{
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(255,255,255,.55);
      border-radius: 24px;
      padding: 18px 16px 20px;
      margin: 14px 0;
      box-shadow: 0 18px 40px rgba(0,0,0,.14);
      backdrop-filter: blur(10px);
    }
    .card-header{
      display:flex;
      align-items:center;
      gap:10px;
      margin-bottom:12px;
    }
    .card-header h2{
      margin:0;
      font-size:18px;
      font-weight:900;
      letter-spacing:-.3px;
    }
    .badge{
      font-size:12px;
      font-weight:900;
      padding:4px 10px;
      border-radius:999px;
      background: rgba(255,95,179,.14);
      border: 1px solid rgba(255,95,179,.18);
      color:#b53a86;
    }

    label{
      display:block;
      margin: 14px 0 6px;
      font-size:14px;
      font-weight:900;
      letter-spacing:-.2px;
    }
    select, input{
      width:100%;
      padding: 14px 14px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      font-size:15px;
      outline:none;
    }
    select:disabled, input:disabled{
      background: rgba(245,245,245,.9);
      color:#aaa;
    }

    .helper{
      margin-top:10px;
      font-size:12.5px;
      color:rgba(0,0,0,.55);
      font-weight:700;
    }

    /* ë¼ë””ì˜¤ */
    .radio-row{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-top:8px;
    }
    .radio-pill{
      display:flex;
      gap:10px;
    }
    .pill{
      flex:1;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 12px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.14);
      background: rgba(255,255,255,.85);
      font-weight:900;
      letter-spacing:-.2px;
    }
    .pill input{ accent-color:#ff5fb3; }

    /* ê°œì¸ì •ë³´ ì²´í¬ë°•ìŠ¤: âœ… ì²´í¬ë°•ìŠ¤-í…ìŠ¤íŠ¸ ê°„ê²© ë¶™ì´ê¸° */
    .consent{
      margin-top:14px;
      padding: 14px 14px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.80);
    }
    .consent-row{
      display:flex;
      align-items:flex-start;
      gap:8px; /* âœ… ì—¬ê¸°ì„œ ê°„ê²© ì œì–´ */
      font-size:13px;
      line-height:1.45;
      font-weight:700;
      color:rgba(0,0,0,.82);
    }
    .consent-row input{
      width:auto;
      margin: 2px 0 0;
      transform: scale(1.1);
    }
    .consent small{
      display:block;
      margin-top:6px;
      color:rgba(0,0,0,.55);
      font-weight:700;
    }

    /* ë²„íŠ¼: âœ… ëˆˆì— ë„ì§€ë§Œ ë‹¨ì •í•œ ê³ ê¸‰ ê·¸ë¼ */
    .btn{
      width:100%;
      border:none;
      margin-top:18px;
      padding: 16px 0;
      border-radius: 999px;
      font-size:17px;
      font-weight:900;
      letter-spacing:-.2px;
      color:#fff;
      background: linear-gradient(135deg,#ff6fb1 0%, #ff5a95 45%, #c97cff 100%);
      box-shadow: 0 14px 28px rgba(255,90,160,.40);
      cursor:pointer;
      transition: transform .08s ease, filter .15s ease, opacity .15s ease;
    }
    .btn:active{ transform: scale(.99); }
    .btn:disabled{ opacity:.45; cursor:not-allowed; filter:saturate(.6); }

    .foot{
      margin-top:10px;
      text-align:center;
      font-size:13px;
      font-weight:700;
      color:rgba(0,0,0,.55);
    }

    /* í† ìŠ¤íŠ¸ */
    .toast{
      position:fixed;
      left:50%;
      bottom:22px;
      transform:translateX(-50%);
      background: rgba(25,25,25,.92);
      color:#fff;
      padding: 12px 14px;
      border-radius: 14px;
      font-size:14px;
      font-weight:800;
      letter-spacing:-.2px;
      opacity:0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index:9999;
    }
    .toast.show{
      opacity:1;
      transform:translateX(-50%) translateY(-6px);
    }

    /* ëª¨ë°”ì¼ ìƒë‹¨ safe area */
    @supports (padding: max(0px)){
      .hero{ padding-top: max(22px, env(safe-area-inset-top)); }
    }
  </style>
</head>

<body>
  <section class="hero">
    <div class="title">
      <h1>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</h1>
      <p>ê°„ë‹¨í•œ ì¡°ê±´ ì…ë ¥ìœ¼ë¡œ ë¹„ëŒ€ë©´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
    </div>
  </section>

  <main class="wrap">

    <!-- ì°¨ëŸ‰ ì„ íƒ -->
    <section class="card">
      <div class="card-header">
        <h2>ì°¨ëŸ‰ ì„ íƒ</h2>
        <span class="badge">í•„ìˆ˜</span>
      </div>

      <label for="maker">ì œì¡°ì‚¬</label>
      <select id="maker">
        <option value="">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</option>
      </select>

      <label for="model">ì°¨ì¢…</label>
      <select id="model" disabled>
        <option value="">ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
      </select>

      <label for="grade">ì°¨ëŸ‰ ë“±ê¸‰</label>
      <select id="grade" disabled>
        <option value="">ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
      </select>

      <label for="option">ì˜µì…˜</label>
      <select id="option" disabled>
        <option value="">ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
      </select>

      <div class="helper">â€» ì œì¡°ì‚¬ â†’ ì°¨ì¢… â†’ ë“±ê¸‰ â†’ ì˜µì…˜ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤.</div>
    </section>

    <!-- ì‹ ì²­ ì •ë³´ -->
    <section class="card">
      <div class="card-header">
        <h2>ì‹ ì²­ ì •ë³´</h2>
        <span class="badge">í•„ìˆ˜</span>
      </div>

      <label>ê°œì¸/ê°œì¸ì‚¬ì—…ì/ë²•ì¸</label>
      <div class="radio-row">
        <div class="radio-pill">
          <label class="pill"><input type="radio" name="customerType" value="ê°œì¸" checked>ê°œì¸</label>
          <label class="pill"><input type="radio" name="customerType" value="ê°œì¸ì‚¬ì—…ì">ê°œì¸ì‚¬ì—…ì</label>
          <label class="pill"><input type="radio" name="customerType" value="ë²•ì¸">ë²•ì¸</label>
        </div>
      </div>

      <label for="name">ì„±ëª…</label>
      <input id="name" autocomplete="name" placeholder="ì˜ˆ) í™ê¸¸ë™" />

      <label for="phone">ì—°ë½ì²˜</label>
      <input id="phone" inputmode="tel" autocomplete="tel" placeholder="ì˜ˆ) 010-1234-5678" />

      <label for="delivery">ì°¨ëŸ‰ ì¸ë„ ì‹œê¸°</label>
      <input id="delivery" placeholder="ì˜ˆ) ê°€ëŠ¥í•œ ë¹¨ë¦¬ / 2ì›” ì¤‘ìˆœ / ë¯¸ì •" />

      <label for="kakao">ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë””(ì„ íƒ)</label>
      <input id="kakao" placeholder="ì˜ˆ) melody7017" />

      <div class="consent">
        <div class="consent-row">
          <input id="consent" type="checkbox" />
          <div>
            <strong>[í•„ìˆ˜]</strong> ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.
            <small>
              ìˆ˜ì§‘: ì„±ëª…, ì—°ë½ì²˜, ì¹´ì¹´ì˜¤í†¡ ID(ì„ íƒ), ì°¨ëŸ‰ ì„ íƒ ì •ë³´<br>
              ëª©ì : ê²¬ì Â·ìƒë‹´ ì•ˆë‚´ / ë³´ìœ : ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
            </small>
          </div>
        </div>
      </div>

      <button id="submitBtn" class="btn" disabled>ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°</button>
      <div class="foot">ë°©ë¬¸ ì—†ì´ ëª¨ë‘ ë¹„ëŒ€ë©´ìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</div>

      <!-- fetch ì‹¤íŒ¨ ì‹œ ìë™ fallbackìš© hidden form/iframe -->
      <iframe id="fallbackFrame" name="fallbackFrame" style="display:none"></iframe>
      <form id="fallbackForm" target="fallbackFrame" method="POST" style="display:none"></form>
    </section>

  </main>

  <div id="toast" class="toast">ì²˜ë¦¬ ì¤‘â€¦</div>

<script>
/** =========================
 *  ì„¤ì •
 * ========================= */
const WEBAPP = "https://script.google.com/macros/s/AKfycbyc1TZg4YplZx91lmam-RbpugEWEWKUw3SCAX0-PWUbWfrDDJczIWlOi36CkJQ4VE6A/exec";

/** =========================
 *  DOM
 * ========================= */
const makerEl = document.getElementById('maker');
const modelEl = document.getElementById('model');
const gradeEl = document.getElementById('grade');
const optionEl = document.getElementById('option');
const nameEl = document.getElementById('name');
const phoneEl = document.getElementById('phone');
const deliveryEl = document.getElementById('delivery');
const kakaoEl = document.getElementById('kakao');
const consentEl = document.getElementById('consent');
const submitBtn = document.getElementById('submitBtn');
const toastEl = document.getElementById('toast');
const fallbackForm = document.getElementById('fallbackForm');

/** =========================
 *  ìƒíƒœ
 * ========================= */
let catalog = []; // [{maker, model, grade, option, ...}]
let makers = [];
let models = [];
let grades = [];
let options = [];

/** =========================
 *  ìœ í‹¸
 * ========================= */
function toast(msg, ms=1800){
  toastEl.textContent = msg;
  toastEl.classList.add('show');
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>toastEl.classList.remove('show'), ms);
}
function setOptions(selectEl, list, placeholder){
  selectEl.innerHTML = "";
  const opt0 = document.createElement('option');
  opt0.value = "";
  opt0.textContent = placeholder;
  selectEl.appendChild(opt0);
  for (const v of list){
    const o = document.createElement('option');
    o.value = v;
    o.textContent = v;
    selectEl.appendChild(o);
  }
}
function normalizePhone(v){
  return (v||"").replace(/[^\d]/g,"")
    .replace(/^(\d{3})(\d{3,4})(\d{4}).*$/, "$1-$2-$3");
}
phoneEl.addEventListener('blur', ()=>{ phoneEl.value = normalizePhone(phoneEl.value); });

function getCustomerType(){
  const checked = document.querySelector('input[name="customerType"]:checked');
  return checked ? checked.value : "";
}
function validate(){
  const okVehicle = makerEl.value && modelEl.value && gradeEl.value && optionEl.value;
  const okInfo = nameEl.value.trim() && phoneEl.value.trim() && deliveryEl.value.trim();
  const okConsent = consentEl.checked;
  submitBtn.disabled = !(okVehicle && okInfo && okConsent);
}

/** =========================
 *  Catalog JSONP ë¡œë“œ (CORS íšŒí”¼)
 * ========================= */
function loadCatalog(){
  return new Promise((resolve,reject)=>{
    const cb = "cb_" + Math.random().toString(16).slice(2);
    window[cb] = (data)=>{
      try{
        delete window[cb];
        script.remove();
      }catch(e){}
      resolve(data);
    };
    const script = document.createElement('script');
    script.src = WEBAPP + "?action=catalog&callback=" + cb + "&_=" + Date.now();
    script.onerror = ()=>reject(new Error("catalog load failed"));
    document.head.appendChild(script);
  });
}

/** =========================
 *  ë“œë¡­ë‹¤ìš´ ì—°ë™ ë¡œì§
 * ========================= */
function buildMaker(){
  makers = [...new Set(catalog.map(x=>x.maker).filter(Boolean))].sort();
  setOptions(makerEl, makers, "ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”");
  makerEl.disabled = false;
}
function onMaker(){
  const maker = makerEl.value;
  modelEl.disabled = !maker;
  gradeEl.disabled = true;
  optionEl.disabled = true;
  setOptions(modelEl, [], "ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  setOptions(gradeEl, [], "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  setOptions(optionEl, [], "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

  if(!maker){ validate(); return; }

  models = [...new Set(catalog.filter(x=>x.maker===maker).map(x=>x.model).filter(Boolean))].sort();
  setOptions(modelEl, models, "ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  validate();
}
function onModel(){
  const maker = makerEl.value;
  const model = modelEl.value;
  gradeEl.disabled = !(maker && model);
  optionEl.disabled = true;
  setOptions(gradeEl, [], "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  setOptions(optionEl, [], "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

  if(!(maker && model)){ validate(); return; }

  grades = [...new Set(catalog.filter(x=>x.maker===maker && x.model===model).map(x=>x.grade).filter(Boolean))].sort();
  setOptions(gradeEl, grades, "ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  validate();
}
function onGrade(){
  const maker = makerEl.value;
  const model = modelEl.value;
  const grade = gradeEl.value;
  optionEl.disabled = !(maker && model && grade);
  setOptions(optionEl, [], "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");

  if(!(maker && model && grade)){ validate(); return; }

  options = [...new Set(catalog.filter(x=>x.maker===maker && x.model===model && x.grade===grade).map(x=>x.option).filter(Boolean))].sort();
  setOptions(optionEl, options, "ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”");
  validate();
}

makerEl.addEventListener('change', onMaker);
modelEl.addEventListener('change', onModel);
gradeEl.addEventListener('change', onGrade);
optionEl.addEventListener('change', validate);
[nameEl, phoneEl, deliveryEl, kakaoEl, consentEl].forEach(el=>el.addEventListener('input', validate));
document.querySelectorAll('input[name="customerType"]').forEach(el=>el.addEventListener('change', validate));

/** =========================
 *  ì œì¶œ: fetch ì‹œë„ -> ì‹¤íŒ¨ ì‹œ iframe í¼ fallback
 * ========================= */
async function submit(){
  validate();
  if(submitBtn.disabled) return;

  const payload = {
    maker: makerEl.value,
    model: modelEl.value,
    grade: gradeEl.value,
    option: optionEl.value,
    customerType: getCustomerType(),
    name: nameEl.value.trim(),
    phone: phoneEl.value.trim(),
    delivery: deliveryEl.value.trim(),
    kakao: kakaoEl.value.trim(),
    consent: consentEl.checked,
    source: "github-pages",
    ts: new Date().toISOString()
  };

  submitBtn.disabled = true;
  toast("ì ‘ìˆ˜ ì¤‘â€¦", 2000);

  // 1) fetch (ë˜ë©´ ê°€ì¥ ê¹”ë”)
  try{
    const res = await fetch(WEBAPP + "?action=submit", {
      method:"POST",
      headers:{ "Content-Type":"application/json" },
      body: JSON.stringify(payload)
    });
    const data = await res.json();
    if(!data || !data.ok) throw new Error("submit failed");
    toast("ì ‘ìˆ˜ ì™„ë£Œ! ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ™‚", 2200);
    resetForm();
    return;
  }catch(e){
    // 2) fallback: CORS ë§‰íˆë©´ iframe í¼ POSTë¡œ ë³´ë‚´ê³  ì„±ê³µ í† ìŠ¤íŠ¸ë§Œ ë³´ì—¬ì£¼ê¸°
    toast("ì ‘ìˆ˜ ì™„ë£Œ! ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ™‚", 2200);
    try{
      fallbackForm.action = WEBAPP + "?action=submit";
      fallbackForm.innerHTML = "";
      const add = (k,v)=>{
        const input = document.createElement('input');
        input.type = "hidden";
        input.name = k;
        input.value = (v ?? "");
        fallbackForm.appendChild(input);
      };
      for (const [k,v] of Object.entries(payload)) add(k, typeof v === "boolean" ? (v ? "true" : "false") : v);
      fallbackForm.submit();
    }catch(_){}
    resetForm();
  }
}

function resetForm(){
  // ì°¨ëŸ‰ ì„ íƒ ì´ˆê¸°í™”
  makerEl.value = "";
  onMaker();
  modelEl.value = "";
  gradeEl.value = "";
  optionEl.value = "";
  modelEl.disabled = true;
  gradeEl.disabled = true;
  optionEl.disabled = true;

  // ì‹ ì²­ ì •ë³´ ì´ˆê¸°í™”
  nameEl.value = "";
  phoneEl.value = "";
  deliveryEl.value = "";
  kakaoEl.value = "";
  consentEl.checked = false;

  // ë¼ë””ì˜¤ ê¸°ë³¸ê°’(ê°œì¸)
  const personal = document.querySelector('input[name="customerType"][value="ê°œì¸"]');
  if(personal) personal.checked = true;

  validate();
}

submitBtn.addEventListener('click', submit);

/** =========================
 *  ì´ˆê¸° ë¡œë”©
 * ========================= */
(async function init(){
  makerEl.disabled = true;
  try{
    const data = await loadCatalog();
    if(!data || !data.ok || !Array.isArray(data.items)) throw new Error("bad catalog");
    catalog = data.items;
    buildMaker();
    toast("ëª¨ë¸ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì™”ì–´ìš”", 1200);
  }catch(e){
    makerEl.innerHTML = `<option value="">ëª¨ë¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨</option>`;
    toast("ëª¨ë¸ ë°ì´í„°ë¥¼ ëª» ë¶ˆëŸ¬ì™”ì–´ìš”. ì›¹ì•± ë°°í¬/ê¶Œí•œ í™•ì¸í•´ì£¼ì„¸ìš”", 2600);
  }finally{
    validate();
  }
})();
</script>
</body>
</html>
