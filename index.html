<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</title>

  <style>
    :root{
      --api-url: "https://script.google.com/macros/s/AKfycbxxxxxxxxxxxxxxxxxxxxxxxxxxxx/exec";

      --text:#221a22;
      --muted: rgba(34,26,34,.62);

      /* âœ… ë°”ë”” í•‘í¬ ë² ì´ìŠ¤: ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì˜…ì–´ì§€ê²Œ */
      --pink1: rgba(255, 150, 210, .30);
      --pink2: rgba(255, 150, 210, .14);
      --pink3: rgba(255, 255, 255, .00);

      --card:#ffffff;
      --stroke: rgba(0,0,0,.08);
      --shadow: 0 18px 45px rgba(0,0,0,.10);

      /* ë²„íŠ¼ ê·¸ë¼(ë‹¨ì •í•˜ê²Œ, ëˆˆì— ë„ê²Œ) */
      --btnA: rgba(255,111,177,.95);
      --btnB: rgba(175,120,245,.95);
      --btnC: rgba(140,125,255,.95);

      --max: 980px;
      --radius-xl: 28px;
      --radius-lg: 22px;
      --radius-md: 16px;
    }

    *{ box-sizing:border-box; }
    html, body{ height:100%; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Apple SD Gothic Neo, sans-serif;
      color: var(--text);
      min-height: 100vh;

      /* âœ… ë°°ê²½ìƒ‰ ê·¸ë¼ â€œí™•ì‹¤íˆâ€ ë³´ì´ê²Œ: radial + linear 2ê²¹ */
      background:
        radial-gradient(900px 520px at 50% 0%,
          rgba(255,160,220,.32) 0%,
          rgba(255,160,220,.18) 40%,
          rgba(255,255,255,0) 72%
        ),
        linear-gradient(180deg,
          var(--pink1) 0%,
          var(--pink2) 38%,
          rgba(255,150,210,.08) 60%,
          var(--pink3) 100%
        );
    }

    .wrap{
      max-width: var(--max);
      margin: 0 auto;
      padding: 0 16px 36px;
      position: relative;
    }

    /* âœ… ì—¬ê¸°ì„œë¶€í„°ê°€ í•µì‹¬: bg.png + ê·¸ë¼ë¥¼ background-image 2ê²¹ìœ¼ë¡œ! */
    .hero{
      position: relative;
      height: 340px;
      margin: 0 -16px;
      border-bottom-left-radius: 24px;
      border-bottom-right-radius: 24px;
      overflow: hidden;

      /* âœ… 1ê²¹: í˜ì´ë“œ ê·¸ë¼(ì•„ë˜ë¡œ ê°ˆìˆ˜ë¡ ì˜…ì–´ì§€ê²Œ) + 2ê²¹: ì´ë¯¸ì§€ */
      background-image:
        linear-gradient(180deg,
          rgba(255,255,255,0) 0%,
          rgba(255,180,225,.10) 48%,
          rgba(255,150,210,.28) 72%,
          rgba(255,150,210,.46) 100%
        ),
        url("bg.png");
      background-size: cover, cover;
      background-position: center top, center top;
      background-repeat: no-repeat, no-repeat;

      /* âœ… ë°°ê²½ ë†ë„ ë‚®ì¶”ê¸° */
      filter: saturate(1.02) contrast(1.02);
    }

    header{
      position: relative;
      text-align:center;
      padding: 44px 14px 22px;
      z-index: 2;
    }
    h1{
      margin:0;
      font-size: 30px;
      letter-spacing: -0.6px;
      font-weight: 900;
      text-shadow: 0 2px 10px rgba(0,0,0,.12), 0 1px 0 rgba(255,255,255,.35);
    }
    .sub{
      margin: 10px 0 0;
      font-size: 14px;
      font-weight: 800;
      color: rgba(34,26,34,.66);
      text-shadow: 0 1px 0 rgba(255,255,255,.40);
    }

    /* âœ… shellë„ ë„ˆë¬´ í•˜ì–—ê²Œ ë®ì§€ ë§ê³ , ë°°ê²½ ê·¸ë¼ê°€ ì‚´ì§ ë¹„ì¹˜ê²Œ */
    .shell{
      position: relative;
      margin-top: -54px;
      border-radius: var(--radius-xl);
      background: rgba(255,255,255,.38);
      border: 1px solid rgba(255,255,255,.55);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      overflow: hidden;
      z-index: 3;
    }

    .content{ padding: 16px; }

    .section{
      background: rgba(255,255,255,.94);
      border: 1px solid var(--stroke);
      border-radius: var(--radius-lg);
      padding: 16px;
      box-shadow: 0 10px 28px rgba(0,0,0,.06);
    }
    .section + .section{ margin-top: 14px; }

    .sec-title{
      display:flex;
      align-items:center;
      gap:10px;
      margin: 2px 0 12px;
      font-weight: 900;
      font-size: 16px;
    }
    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 4px 10px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 900;
      color: #a0186e;
      background: rgba(255,111,177,.14);
      border: 1px solid rgba(255,111,177,.18);
    }

    label{
      display:block;
      margin-top: 12px;
      font-size: 13px;
      font-weight: 900;
      color: rgba(34,26,34,.86);
    }

    select, input{
      width: 100%;
      margin-top: 7px;
      padding: 12px 12px;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.98);
      outline: none;
      font-size: 14px;
    }
    select:disabled, input:disabled{ opacity: .6; }
    input::placeholder{ color: rgba(34,26,34,.40); }

    .help{
      margin-top: 10px;
      font-size: 12px;
      color: rgba(34,26,34,.55);
      font-weight: 800;
    }

    .radio-row{
      display:flex;
      gap:10px;
      flex-wrap: wrap;
      margin-top: 8px;
    }
    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.10);
      background: rgba(255,255,255,.98);
      font-weight: 900;
      font-size: 13px;
    }
    .chip input{ width:auto; margin:0; }

    /* âœ… ê°œì¸ì •ë³´ ë™ì˜: ì²´í¬ë°•ìŠ¤-í…ìŠ¤íŠ¸ ê±°ë¦¬ í•´ê²° */
    .consent{
      margin-top: 14px;
      background: rgba(255,255,255,.98);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 18px;
      padding: 14px;
    }
    .consent-row{
      display:flex;
      align-items:flex-start;
      gap: 10px; /* âœ… ì´ê±¸ë¡œ â€œì™œ ì´ë ‡ê²Œ ë©€ì–´?â€ í•´ê²° */
    }
    .consent-row input{
      width: 18px;
      height: 18px;
      margin-top: 2px;
      flex: 0 0 auto;
    }
    .consent strong{
      display:block;
      font-size: 14px;
      font-weight: 900;
      margin-bottom: 6px;
    }
    .consent small{
      display:block;
      color: rgba(34,26,34,.62);
      font-weight: 800;
      line-height: 1.45;
    }

    .cta{
      padding: 16px;
      background: rgba(255,255,255,.62);
      border-top: 1px solid rgba(0,0,0,.06);
    }

    /* âœ… ë²„íŠ¼: ì€ì€í•˜ì§€ë§Œ ì¡´ì¬ê° ìˆê²Œ(ëª©ì—…ì²˜ëŸ¼) */
    .btn{
      width: 100%;
      border: 0;
      cursor: pointer;
      border-radius: 999px;
      padding: 16px 16px;
      font-size: 17px;
      font-weight: 900;
      color: #fff;
      letter-spacing: -0.3px;

      background: linear-gradient(90deg, var(--btnA), var(--btnB), var(--btnC));
      box-shadow:
        0 18px 38px rgba(155,124,255,.22),
        0 12px 28px rgba(255,111,177,.18);
    }
    .btn:active{ transform: translateY(1px); }
    .btn:disabled{
      opacity: .55;
      cursor: not-allowed;
      box-shadow: none;
      filter: grayscale(.25);
    }

    .foot{
      margin-top: 12px;
      text-align:center;
      font-size: 12px;
      color: rgba(34,26,34,.58);
      font-weight: 900;
    }

    @media (min-width: 860px){
      .hero{ height: 420px; }
      h1{ font-size: 34px; }
      header{ padding-top: 62px; }
      .shell{ margin-top: -78px; }
    }
  </style>
</head>

<body>
  <div class="hero">
    <div class="wrap">
      <header>
        <h1>ë¹„ëŒ€ë©´ ì°¨ëŸ‰ ê²¬ì  ìƒë‹´</h1>
        <p class="sub">ê°„ë‹¨í•œ ì¡°ê±´ ì…ë ¥ìœ¼ë¡œ ë¹„ëŒ€ë©´ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤</p>
      </header>
    </div>
  </div>

  <div class="wrap">
    <div class="shell">
      <div class="content">

        <!-- ì°¨ëŸ‰ ì„ íƒ -->
        <section class="section" id="secCar">
          <div class="sec-title">ì°¨ëŸ‰ ì„ íƒ <span class="badge">í•„ìˆ˜</span></div>

          <label for="maker">ì œì¡°ì‚¬</label>
          <select id="maker">
            <option value="">ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          </select>

          <label for="model">ì°¨ì¢…</label>
          <select id="model" disabled>
            <option value="">ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          </select>

          <label for="trim">ì°¨ëŸ‰ ë“±ê¸‰</label>
          <select id="trim" disabled>
            <option value="">ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          </select>

          <label for="option">ì˜µì…˜</label>
          <select id="option" disabled>
            <option value="">ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”</option>
          </select>

          <p class="help">â€» ì œì¡°ì‚¬ â†’ ì°¨ì¢… â†’ ë“±ê¸‰ â†’ ì˜µì…˜ ìˆœì„œë¡œ ì„ íƒë©ë‹ˆë‹¤.</p>
        </section>

        <!-- ì‹ ì²­ ì •ë³´ -->
        <section class="section" id="secApp">
          <div class="sec-title">ì‹ ì²­ ì •ë³´ <span class="badge">í•„ìˆ˜</span></div>

          <label>ê°œì¸/ê°œì¸ì‚¬ì—…ì/ë²•ì¸</label>
          <div class="radio-row" id="customerType">
            <label class="chip"><input type="radio" name="customerType" value="ê°œì¸" checked> ê°œì¸</label>
            <label class="chip"><input type="radio" name="customerType" value="ê°œì¸ì‚¬ì—…ì"> ê°œì¸ì‚¬ì—…ì</label>
            <label class="chip"><input type="radio" name="customerType" value="ë²•ì¸"> ë²•ì¸</label>
          </div>

          <label for="name">ì„±ëª…</label>
          <input id="name" placeholder="ì˜ˆ) í™ê¸¸ë™" autocomplete="name" />

          <label for="phone">ì—°ë½ì²˜</label>
          <input id="phone" placeholder="ì˜ˆ) 010-1234-5678" inputmode="tel" autocomplete="tel" />

          <label for="needAt">ì°¨ëŸ‰ ì¸ë„ ì‹œê¸°</label>
          <input id="needAt" placeholder="ì˜ˆ) ê°€ëŠ¥í•œ ë¹¨ë¦¬ / 2ì›” ì¤‘ìˆœ / ë¯¸ì •" />

          <label for="kakao">ì¹´ì¹´ì˜¤í†¡ ì•„ì´ë””(ì„ íƒ)</label>
          <input id="kakao" placeholder="ì˜ˆ) melody7017" />

          <div class="consent">
            <div class="consent-row">
              <input id="agree" type="checkbox" />
              <div>
                <strong>[í•„ìˆ˜] ê°œì¸ì •ë³´ ìˆ˜ì§‘Â·ì´ìš©ì— ë™ì˜í•©ë‹ˆë‹¤.</strong>
                <small>
                  ìˆ˜ì§‘: ì„±ëª…, ì—°ë½ì²˜, ì¹´ì¹´ì˜¤í†¡ ID(ì„ íƒ), ì°¨ëŸ‰ ì„ íƒ ì •ë³´<br>
                  ëª©ì : ê²¬ì Â·ìƒë‹´ ì•ˆë‚´<br>
                  ë³´ìœ : ìƒë‹´ ì™„ë£Œ í›„ 1ë…„
                </small>
              </div>
            </div>
          </div>
        </section>

      </div>

      <div class="cta">
        <button class="btn" id="submitBtn" disabled>ê°„ë‹¨ ê²¬ì  ìš”ì²­í•˜ê¸°</button>
        <div class="foot">ë°©ë¬¸ ì—†ì´ ëª¨ë‘ ë¹„ëŒ€ë©´ìœ¼ë¡œ ì•ˆë‚´ë“œë¦½ë‹ˆë‹¤.</div>
      </div>
    </div>
  </div>

  <script>
    const API_URL = getComputedStyle(document.documentElement).getPropertyValue('--api-url').trim().replace(/^"|"$/g,'');
    const els = {
      maker: document.getElementById('maker'),
      model: document.getElementById('model'),
      trim: document.getElementById('trim'),
      option: document.getElementById('option'),
      name: document.getElementById('name'),
      phone: document.getElementById('phone'),
      needAt: document.getElementById('needAt'),
      kakao: document.getElementById('kakao'),
      agree: document.getElementById('agree'),
      submitBtn: document.getElementById('submitBtn')
    };

    let catalog = [];
    const uniq = (arr)=> Array.from(new Set(arr)).filter(Boolean).sort((a,b)=>a.localeCompare(b,'ko'));
    const valRadio = (name)=> (document.querySelector(`input[name="${name}"]:checked`)||{}).value || "";

    function setOptions(select, arr, placeholder){
      select.innerHTML = '';
      const ph = document.createElement('option');
      ph.value = '';
      ph.textContent = placeholder;
      select.appendChild(ph);
      arr.forEach(v=>{
        const opt = document.createElement('option');
        opt.value = v;
        opt.textContent = v;
        select.appendChild(opt);
      });
    }

    function resetDown(from){
      if(from === 'maker'){
        els.model.disabled = true; setOptions(els.model, [], 'ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.trim.disabled = true; setOptions(els.trim, [], 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      if(from === 'model'){
        els.trim.disabled = true; setOptions(els.trim, [], 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      if(from === 'trim'){
        els.option.disabled = true; setOptions(els.option, [], 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
      }
      validate();
    }

    function validate(){
      const okCar = !!els.maker.value && !!els.model.value && !!els.trim.value && !!els.option.value;
      const okApp = els.name.value.trim().length > 1
                 && els.phone.value.trim().length >= 8
                 && els.needAt.value.trim().length >= 1;
      els.submitBtn.disabled = !(okCar && okApp && els.agree.checked);
    }

    async function fetchCatalog(){
      const res = await fetch(`${API_URL}?action=catalog`);
      if(!res.ok) throw new Error('ì¹´íƒˆë¡œê·¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      const data = await res.json();
      catalog = Array.isArray(data) ? data : (data.items || []);
    }

    function initMaker(){
      const makers = uniq(catalog.map(r => r.maker || r.ì œì¡°ì‚¬));
      setOptions(els.maker, makers, 'ì œì¡°ì‚¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onMaker(){
      resetDown('maker');
      const maker = els.maker.value;
      if(!maker) return;

      const models = uniq(
        catalog
          .filter(r => (r.maker || r.ì œì¡°ì‚¬) === maker)
          .map(r => r.model || r.ì°¨ì¢… || r.ëª¨ë¸)
      );
      els.model.disabled = false;
      setOptions(els.model, models, 'ì°¨ì¢…ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onModel(){
      resetDown('model');
      const maker = els.maker.value;
      const model = els.model.value;
      if(!maker || !model) return;

      const trims = uniq(
        catalog
          .filter(r => (r.maker || r.ì œì¡°ì‚¬) === maker && (r.model || r.ì°¨ì¢… || r.ëª¨ë¸) === model)
          .map(r => r.trim || r.ì°¨ëŸ‰ë“±ê¸‰ || r.íŠ¸ë¦¼ || r.ë“±ê¸‰)
      );
      els.trim.disabled = false;
      setOptions(els.trim, trims, 'ì°¨ëŸ‰ ë“±ê¸‰ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    function onTrim(){
      resetDown('trim');
      const maker = els.maker.value;
      const model = els.model.value;
      const trim  = els.trim.value;
      if(!maker || !model || !trim) return;

      const options = uniq(
        catalog
          .filter(r =>
            (r.maker || r.ì œì¡°ì‚¬) === maker &&
            (r.model || r.ì°¨ì¢… || r.ëª¨ë¸) === model &&
            (r.trim  || r.ì°¨ëŸ‰ë“±ê¸‰ || r.íŠ¸ë¦¼ || r.ë“±ê¸‰) === trim
          )
          .map(r => r.option || r.ì˜µì…˜)
      );
      els.option.disabled = false;
      setOptions(els.option, options, 'ì˜µì…˜ì„ ì„ íƒí•´ì£¼ì„¸ìš”');
    }

    async function submit(){
      els.submitBtn.disabled = true;
      const oldText = els.submitBtn.textContent;
      els.submitBtn.textContent = 'ì „ì†¡ ì¤‘...';

      const payload = {
        maker: els.maker.value,
        model: els.model.value,
        trim: els.trim.value,
        option: els.option.value,
        customerType: valRadio('customerType'),
        name: els.name.value.trim(),
        phone: els.phone.value.trim(),
        needAt: els.needAt.value.trim(),
        kakao: els.kakao.value.trim(),
        agreedAt: new Date().toISOString()
      };

      try{
        const res = await fetch(API_URL, {
          method:'POST',
          headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ action:'submit', payload })
        });
        const data = await res.json().catch(()=>({ok:false}));

        if(!res.ok || data.ok === false) throw new Error(data.message || 'ì ‘ìˆ˜ ì‹¤íŒ¨');

        alert('ì ‘ìˆ˜ ì™„ë£Œ! ê³§ ì•ˆë‚´ë“œë¦´ê²Œìš” ğŸ˜Š');
        els.name.value = '';
        els.phone.value = '';
        els.needAt.value = '';
        els.kakao.value = '';
        els.agree.checked = false;
        validate();
      }catch(e){
        alert('ì „ì†¡ ì¤‘ ì˜¤ë¥˜: ' + e.message);
      }finally{
        els.submitBtn.textContent = oldText;
        validate();
      }
    }

    els.maker.addEventListener('change', onMaker);
    els.model.addEventListener('change', onModel);
    els.trim.addEventListener('change', onTrim);
    els.option.addEventListener('change', validate);

    ['input','change'].forEach(evt=>{
      els.name.addEventListener(evt, validate);
      els.phone.addEventListener(evt, validate);
      els.needAt.addEventListener(evt, validate);
      els.kakao.addEventListener(evt, validate);
      els.agree.addEventListener(evt, validate);
      document.getElementById('customerType').addEventListener(evt, validate);
    });

    els.submitBtn.addEventListener('click', submit);

    (async function(){
      try{
        await fetchCatalog();
        initMaker();
      }catch(e){
        alert('ì´ˆê¸° ë¡œë”© ì‹¤íŒ¨: ' + e.message + '\n(ì›¹ì•± URL / action=catalog ì‘ë‹µ í™•ì¸)');
      }
    })();
  </script>
</body>
</html>
