<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>비대면 견적 요청</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.css">
    <style>
        :root {
            --neon-blue: #00d4ff;
            --glass-bg: rgba(10, 10, 15, 0.75);
            --input-bg: rgba(255, 255, 255, 0.05);
            --border: rgba(255, 255, 255, 0.1);
        }

        body {
            margin: 0; padding: 0;
            font-family: 'Pretendard', sans-serif;
            /* 배경 이미지를 bg.png로 설정 */
            background: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('bg.png') no-repeat center center fixed;
            background-size: cover;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; color: #ffffff;
        }

        /* 메인 카드 박스 - 시안의 반투명 효과 */
        .container {
            background: var(--glass-bg);
            width: 95%; max-width: 460px;
            padding: 40px 25px;
            border-radius: 30px;
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border);
            box-shadow: 0 20px 60px rgba(0,0,0,0.8);
        }

        h2 { text-align: center; font-weight: 700; font-size: 1.5rem; margin-bottom: 30px; letter-spacing: -1px; }

        /* 상단 렌트/리스 선택 탭 */
        .tab-box {
            display: flex; background: var(--input-bg);
            padding: 4px; border-radius: 15px; margin-bottom: 25px;
            border: 1px solid var(--border);
        }
        .tab-box label {
            flex: 1; text-align: center; padding: 12px; cursor: pointer;
            border-radius: 12px; font-weight: 600; font-size: 0.95rem; transition: 0.3s; color: #888;
        }
        .tab-box input { display: none; }
        .tab-box input:checked + label {
            background: var(--neon-blue); color: #000;
            box-shadow: 0 0 15px rgba(0, 212, 255, 0.5);
        }

        .label { font-size: 0.85rem; color: var(--neon-blue); margin: 0 0 8px 5px; font-weight: 600; }

        /* 입력 폼 요소 */
        select, input {
            width: 100%; padding: 15px; border-radius: 15px; border: 1px solid var(--border);
            background: var(--input-bg); color: #fff; box-sizing: border-box;
            font-size: 1rem; margin-bottom: 15px; transition: 0.3s; outline: none;
        }
        select:focus, input:focus { border-color: var(--neon-blue); box-shadow: 0 0 10px rgba(0, 212, 255, 0.2); }
        select option { background: #111; }

        /* 옵션 선택 박스 */
        .option-list {
            background: rgba(0,0,0,0.2); border-radius: 15px;
            padding: 10px; max-height: 140px; overflow-y: auto;
            border: 1px solid var(--border); margin-bottom: 20px;
        }
        .opt-item {
            display: flex; align-items: center; padding: 10px; font-size: 0.9rem;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .opt-item input { width: 18px; height: 18px; margin-right: 12px; accent-color: var(--neon-blue); }

        /* 가격 정보창 */
        .total-price-box {
            background: rgba(0, 212, 255, 0.08); padding: 20px;
            border-radius: 20px; text-align: right; margin-bottom: 25px;
            border: 1px solid rgba(0, 212, 255, 0.2);
        }
        .total-price-box .val { font-size: 1.8rem; color: var(--neon-blue); font-weight: 800; }

        /* 개인정보 동의 */
        .agree-text { font-size: 0.8rem; color: #aaa; display: flex; align-items: center; gap: 8px; }
        .agree-text input { accent-color: var(--neon-blue); }

        /* 전송 버튼 - 시안의 네온 블루 느낌 */
        .btn-submit {
            width: 100%; padding: 20px; background: var(--neon-blue);
            color: #000; border: none; border-radius: 18px;
            font-size: 1.15rem; font-weight: 800; cursor: pointer;
            margin-top: 25px; transition: 0.4s;
            box-shadow: 0 10px 25px rgba(0, 212, 255, 0.3);
        }
        .btn-submit:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(0, 212, 255, 0.5); }
        .btn-submit:disabled { background: #333; color: #666; cursor: not-allowed; box-shadow: none; }
    </style>
</head>
<body>

<div class="container">
    <h2>렌트/리스 견적 요청</h2>
    
    <form id="quoteForm">
        <div class="tab-box">
            <input type="radio" id="r" name="dealType" value="장기렌트" checked>
            <label for="r">장기렌트</label>
            <input type="radio" id="l" name="dealType" value="자동차리스">
            <label for="l">자동차리스</label>
        </div>

        <div class="label">차량 정보</div>
        <select id="mkr"><option value="">제조사 선택</option></select>
        <select id="mdl" disabled><option value="">모델 선택</option></select>
        <select id="trm" disabled><option value="">트림 선택</option></select>

        <div class="label">추가 옵션</div>
        <div id="optContainer" class="option-list">
            <p style="text-align:center; color:#555; font-size:0.8rem; margin-top:40px;">트림을 선택해 주세요</p>
        </div>

        <div class="total-price-box">
            <span style="font-size:0.85rem; color:#aaa;">최종 차량가</span><br>
            <span class="val" id="totalVal">0</span>원
        </div>

        <div class="label">상담 신청 정보</div>
        <input type="text" id="name" placeholder="성함" required>
        <input type="tel" id="phone" placeholder="휴대폰 번호 (- 없이)" required>
        <input type="text" id="kakao" placeholder="카카오톡 ID (선택)">

        <div class="agree-text">
            <input type="checkbox" id="agree" required>
            <label for="agree">개인정보 수집 및 제3자 제공에 동의합니다.</label>
        </div>

        <button type="submit" id="submitBtn" class="btn-submit">무료 견적 신청하기</button>
    </form>
</div>

<script>
    const API = 'https://script.google.com/macros/s/AKfycbxE58tNJ_Nfr5KNFMp0b6P4dWyBGnP_CPDiTuontpL1u4b931Tx6EWn5iCR9CqjEzne/exec';
    let dataStore = [];
    let basePriceValue = 0;

    async function fetchData() {
        try {
            const r = await fetch(`${API}?action=catalog`);
            dataStore = await r.json();
            const makers = [...new Set(dataStore.map(x => x.maker))];
            const mSel = document.getElementById('mkr');
            makers.forEach(m => mSel.add(new Option(m, m)));
        } catch (e) { alert("데이터 로드 오류"); }
    }

    document.getElementById('mkr').onchange = (e) => {
        const models = [...new Set(dataStore.filter(x => x.maker === e.target.value).map(x => x.model))];
        setSelect('mdl', models, "모델 선택");
        resetOptions();
    };

    document.getElementById('mdl').onchange = (e) => {
        const trims = [...new Set(dataStore.filter(x => x.model === e.target.value).map(x => x.trim))];
        setSelect('trm', trims, "트림 선택");
        resetOptions();
    };

    document.getElementById('trm').onchange = (e) => {
        const rows = dataStore.filter(x => x.trim === e.target.value && x.model === document.getElementById('mdl').value);
        if(rows.length > 0) {
            basePriceValue = rows[0].basePrice;
            const container = document.getElementById('optContainer');
            container.innerHTML = '';
            rows.forEach(row => {
                if(row.optionName) {
                    const item = document.createElement('div');
                    item.className = 'opt-item';
                    item.innerHTML = `<input type="checkbox" name="o" value="${row.optionPrice}" data-n="${row.optionName}" onchange="calcPrice()">
                                      <span>${row.optionName} (+${row.optionPrice.toLocaleString()}원)</span>`;
                    container.appendChild(item);
                }
            });
            calcPrice();
        }
    };

    function setSelect(id, list, msg) {
        const el = document.getElementById(id);
        el.innerHTML = `<option value="">${msg}</option>`;
        list.forEach(v => el.add(new Option(v, v)));
        el.disabled = false;
    }

    function resetOptions() {
        document.getElementById('optContainer').innerHTML = '<p style="text-align:center; color:#555; font-size:0.8rem; margin-top:40px;">트림을 선택해 주세요</p>';
        basePriceValue = 0;
        calcPrice();
    }

    function calcPrice() {
        let sum = 0;
        document.querySelectorAll('input[name="o"]:checked').forEach(c => sum += Number(c.value));
        document.getElementById('totalVal').innerText = (basePriceValue + sum).toLocaleString();
    }

    document.getElementById('quoteForm').onsubmit = async (e) => {
        e.preventDefault();
        const btn = document.getElementById('submitBtn');
        btn.disabled = true; btn.innerText = "전송중...";

        const opts = Array.from(document.querySelectorAll('input[name="o"]:checked')).map(c => c.dataset.n).join(', ');
        const optSum = Array.from(document.querySelectorAll('input[name="o"]:checked')).reduce((a,b)=>a+Number(b.value), 0);

        const params = new URLSearchParams({
            action: 'submit',
            dealType: document.querySelector('input[name="dealType"]:checked').value,
            maker: document.getElementById('mkr').value,
            model: document.getElementById('mdl').value,
            trim: document.getElementById('trm').value,
            options: opts,
            basePrice: basePriceValue,
            optionPrice: optSum,
            totalPrice: basePriceValue + optSum,
            applicantName: document.getElementById('name').value,
            phone: document.getElementById('phone').value,
            kakaoId: document.getElementById('kakao').value,
            submittedAt: new Date().toLocaleString()
        });

        try {
            await fetch(`${API}?${params.toString()}`, { mode: 'no-cors' });
            alert("상담 신청이 완료되었습니다!");
            location.reload();
        } catch(e) {
            alert("전송 오류가 발생했습니다.");
            btn.disabled = false; btn.innerText = "무료 견적 신청하기";
        }
    };

    fetchData();
</script>
</body>
</html>
